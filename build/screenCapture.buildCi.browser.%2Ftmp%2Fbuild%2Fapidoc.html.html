<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/soyuka/pidusage">pidusage (v1.1.1)</a>
</h1>
<h4>Cross-platform process cpu % and memory usage of a PID â€” Edit</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.pidusage">module pidusage</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.stat">
            function <span class="apidocSignatureSpan">pidusage.</span>stat
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.unmonitor">
            function <span class="apidocSignatureSpan">pidusage.</span>unmonitor
            <span class="apidocSignatureSpan">(pid)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">pidusage.</span>_history</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">pidusage.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">pidusage.</span>stats</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.pidusage.helpers">module pidusage.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.helpers.cpu">
            function <span class="apidocSignatureSpan">pidusage.helpers.</span>cpu
            <span class="apidocSignatureSpan">(next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.helpers.getconf">
            function <span class="apidocSignatureSpan">pidusage.helpers.</span>getconf
            <span class="apidocSignatureSpan">(keyword, options, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.pidusage.stats">module pidusage.stats</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.stats.proc">
            function <span class="apidocSignatureSpan">pidusage.stats.</span>proc
            <span class="apidocSignatureSpan">(pid, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.stats.proc_calc">
            function <span class="apidocSignatureSpan">pidusage.stats.</span>proc_calc
            <span class="apidocSignatureSpan">(pid, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.stats.ps">
            function <span class="apidocSignatureSpan">pidusage.stats.</span>ps
            <span class="apidocSignatureSpan">(pid, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.pidusage.stats.win">
            function <span class="apidocSignatureSpan">pidusage.stats.</span>win
            <span class="apidocSignatureSpan">(pid, options, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">pidusage.stats.</span>cpu</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">pidusage.stats.</span>history</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.pidusage" id="apidoc.module.pidusage">module pidusage</a></h1>


    <h2>
        <a href="#apidoc.element.pidusage.stat" id="apidoc.element.pidusage.stat">
        function <span class="apidocSignatureSpan">pidusage.</span>stat
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stat = function () {
  pusage[platform].apply(stats, [].slice.call(arguments));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### 1.0.5

Windows: (wmic) Use raw data instead of formatted this should speed up wmic

### 0.1.0
API changes:
```
require('pidusage').<span class="apidocCodeKeywordSpan">stat</span>(pid, fn)
```
instead of:
```
require('pidusage')(pid, fn)
```
Adds a `unmonitor` method to clear process history
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.pidusage.unmonitor" id="apidoc.element.pidusage.unmonitor">
        function <span class="apidocSignatureSpan">pidusage.</span>unmonitor
        <span class="apidocSignatureSpan">(pid)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unmonitor = function (pid) {
  delete stats.history[pid];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

	console.log('Pcpu: %s', stat.cpu)
	console.log('Mem: %s', stat.memory) //those are bytes

})

// Unmonitor process
pusage.<span class="apidocCodeKeywordSpan">unmonitor</span>(process.pid);
```

## How it works

A check on the `os.platform` is done to determine the method to use.

### Linux
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.pidusage.helpers" id="apidoc.module.pidusage.helpers">module pidusage.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.pidusage.helpers.cpu" id="apidoc.element.pidusage.helpers.cpu">
        function <span class="apidocSignatureSpan">pidusage.helpers.</span>cpu
        <span class="apidocSignatureSpan">(next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">cpu = function (next) {
  var self = this

  self.getconf('CLK_TCK', {default: 100}, function(err, clock_tick) {
    self.getconf('PAGESIZE', {default: 4096}, function(err, pagesize) {

      next(null, {
        clock_tick: clock_tick,
        uptime: os.uptime(),
        pagesize: pagesize
      })

     })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else {
      self.cpu.uptime = uptime.split(' ')[0]
    }

    return self.proc_calc(pid, options, done)
  })
} else {
  helpers.<span class="apidocCodeKeywordSpan">cpu</span>(function(err, cpu) {
    if(err)
      return done(err, null)

    self.cpu = cpu
    return self.proc_calc(pid, options, done)
  })
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.pidusage.helpers.getconf" id="apidoc.element.pidusage.helpers.getconf">
        function <span class="apidocSignatureSpan">pidusage.helpers.</span>getconf
        <span class="apidocSignatureSpan">(keyword, options, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getconf = function (keyword, options, next) {

  if(typeof options == 'function') {
    next = options
    options = { default: '' }
  }

  exec('getconf '+keyword, function(error, stdout, stderr) {
    if(error !== null) {
      console.error('Error while getting '+keyword, error)
      return next(null, options.default)
    }

    stdout = parseInt(stdout)

    if(!isNaN(stdout)) {
      return next(null, stdout)
    }

    return next(null, options.default)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

      return next(null, options.default)
    })
  },
  cpu: function(next) {
    var self = this

    self.<span class="apidocCodeKeywordSpan">getconf</span>('CLK_TCK', {default: 100}, function(err, clock_tick) {
      self.getconf('PAGESIZE', {default: 4096}, function(err, pagesize) {

next(null, {
  clock_tick: clock_tick,
  uptime: os.uptime(),
  pagesize: pagesize
})
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.pidusage.stats" id="apidoc.module.pidusage.stats">module pidusage.stats</a></h1>


    <h2>
        <a href="#apidoc.element.pidusage.stats.proc" id="apidoc.element.pidusage.stats.proc">
        function <span class="apidocSignatureSpan">pidusage.stats.</span>proc
        <span class="apidocSignatureSpan">(pid, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proc = function (pid, options, done) {
  var self = this

  if(this.cpu !== null) {
    fs.readFile('/proc/uptime', 'utf8', function(err, uptime) {
      if(err)
        return done(err, null)

      if(uptime === undefined) {
        console.error("[pidusage] We couldn't find uptime from /proc/uptime")
        self.cpu.uptime = os.uptime()
      } else {
        self.cpu.uptime = uptime.split(' ')[0]
      }

      return self.proc_calc(pid, options, done)
    })
  } else {
    helpers.cpu(function(err, cpu) {
      if(err)
        return done(err, null)

      self.cpu = cpu
      return self.proc_calc(pid, options, done)
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.pidusage.stats.proc_calc" id="apidoc.element.pidusage.stats.proc_calc">
        function <span class="apidocSignatureSpan">pidusage.stats.</span>proc_calc
        <span class="apidocSignatureSpan">(pid, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proc_calc = function (pid, options, done) {
  var history = this.history[pid] ? this.history[pid] : {}
  var cpu = this.cpu
  var self = this

  //Arguments to path.join must be strings
  fs.readFile(p.join('/proc', ''+pid, 'stat'), 'utf8', function(err, infos) {

    if(err)
      return done(err, null)

    //https://github.com/arunoda/node-usage/commit/a6ca74ecb8dd452c3c00ed2bde93294d7bb75aa8
    //preventing process space in name by removing values before last ) (pid (name) ...)
    var index = infos.lastIndexOf(')')
    infos = infos.substr(index + 2).split(' ')

    //according to http://man7.org/linux/man-pages/man5/proc.5.html (index 0 based - 2)
    //In kernels before Linux 2.6, start was expressed in jiffies. Since Linux 2.6, the value is expressed in clock ticks
    var stat = {
        utime: parseFloat(infos[11]),
        stime: parseFloat(infos[12]),
        cutime: parseFloat(infos[13]),
        cstime: parseFloat(infos[14]),
        start: parseFloat(infos[19]) / cpu.clock_tick,
        rss: parseFloat(infos[21])
    }

    //http://stackoverflow.com/questions/16726779/total-cpu-usage-of-an-application-from-proc-pid-stat/16736599#16736599

    var childrens = options.childrens ? stat.cutime + stat.cstime : 0

    var total = stat.stime - (history.stime || 0) + stat.utime - (history.utime || 0) + childrens

    total = total / cpu.clock_tick

    //time elapsed between calls
    var seconds = history.uptime !== undefined ? cpu.uptime - history.uptime : stat.start - cpu.uptime
    seconds = Math.abs(seconds)
    seconds = seconds === 0 ? 1 : seconds //we sure can't divide through 0

    self.history[pid] = stat
    self.history[pid].uptime = cpu.uptime

    return done(null, {
      cpu: (total / seconds) * 100,
      memory: stat.rss * cpu.pagesize
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if(uptime === undefined) {
  console.error("[pidusage] We couldn't find uptime from /proc/uptime")
  self.cpu.uptime = os.uptime()
} else {
  self.cpu.uptime = uptime.split(' ')[0]
}

return self.<span class="apidocCodeKeywordSpan">proc_calc</span>(pid, options, done)
      })
    } else {
      helpers.cpu(function(err, cpu) {
if(err)
  return done(err, null)

self.cpu = cpu
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.pidusage.stats.ps" id="apidoc.element.pidusage.stats.ps">
        function <span class="apidocSignatureSpan">pidusage.stats.</span>ps
        <span class="apidocSignatureSpan">(pid, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ps = function (pid, options, done) {

  var cmd = 'ps -o pcpu,rss -p '

  if(os.platform() == 'aix')
    cmd = 'ps -o pcpu,rssize -p ' //this one could work on other platforms

  exec(cmd + pid, function(err, stdout, stderr) {
    if(err)
      return done(err, null)

    stdout = stdout.split(os.EOL)[1]
    stdout = stdout.replace(/^\s+/, '').replace(/\s\s+/g, ' ').split(' ')

    return done(null, {
      cpu: parseFloat(stdout[0].replace(',', '.')),
      memory: parseFloat(stdout[1]) * 1024
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.pidusage.stats.win" id="apidoc.element.pidusage.stats.win">
        function <span class="apidocSignatureSpan">pidusage.stats.</span>win
        <span class="apidocSignatureSpan">(pid, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">win = function (pid, options, done) {
  var history = this.history[pid] ? this.history[pid] : {}
		//  http://social.msdn.microsoft.com/Forums/en-US/469ec6b7-4727-4773-9dc7-6e3de40e87b8/cpu-usage-in-for-each-active-process-how
-is-this-best-determined-and-implemented-in-an?forum=csharplanguage
  var args = 'PROCESS ' + pid + ' get workingsetsize,usermodetime,kernelmodetime'
  var wmic = spawn('wmic', args.split(' '), {detached: true})
  var stdout = ''
  var stderr = ''
  var self = this
  var uptime = os.uptime()

  wmic.stdout.on('data', function(d) {
   stdout += d.toString()
  })

  wmic.stderr.on('data', function(d) {
    stderr += d.toString()
  })

  wmic.on('error', function(err) {
    console.error('[pidusage] Command "wmic ' + args + '" failed with error %s', err)
  })

  wmic.on('close', function(code) {
    stdout = stdout.trim()
    stderr = stderr.trim()

    if(!stdout || code !== 0) {
      var error = format('%s Wmic errored, please open an issue on https://github.com/soyuka/pidusage with this message.%s', new
 Date().toString(), os.EOL)
      error += format('Command was "wmic %s", release is %s%s', args, os.release(), os.EOL)
      stderr = error + (stderr ? format('Wmic reported the following error: %s.', stderr) : 'Wmic reported no errors.')
      stderr = format('%s%s%s Wmic exited with code %d.%s', os.EOL, stderr, os.EOL, code, os.EOL)
      stdout ? stderr = format('%s%s Stdout was %s', stderr, os.EOL, stdout) : null

      return done(new Error(stderr , null))
    }

    stdout = stdout.split(os.EOL)[1].replace(/\s\s+/g, ' ').split(' ')

    var stats = {
      kernelmodetime: parseFloat(stdout[0]),
      usermodetime: parseFloat(stdout[1]),
    }

    var workingsetsize = parseFloat(stdout[2])

    //process usage since last call
    var total = stats.kernelmodetime - (history.kernelmodetime || 0) + stats.usermodetime - (history.usermodetime || 0)
    total = total / 10000000

    //time elapsed between calls
    var seconds = history.uptime !== undefined ? uptime - history.uptime : 0
    seconds = Math.abs(seconds)
    seconds = seconds === 0 ? 1 : seconds //we sure can't divide through 0

    self.history[pid] = stats
    self.history[pid].uptime = uptime

    return done(null, {cpu: (total / seconds) * 100, memory: workingsetsize})
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>